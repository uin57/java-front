/** * Created by Administrator on 2016/6/6. */var end = false;var loading = false;$(window).scroll(function(){	if($(this).scrollTop() + $(this).height() == $(document).height()){		loadMore();	}});function loadMore() {	if (end) {		$("#loadMore").html("已加载全部");		return false;	}	if (loading) {		return false;	}	loading = true;	var $loadMore = $("#loadMore");	var defaultHtml = $loadMore.html();	$loadMore.html("正在加载...");	doLoad();	loading = false;	$loadMore.html(defaultHtml);}function doLoad() {		ajaxExt({		url:'/user/listRecordBody?start=' + ($(".userListStart").length)+'&account='+$("#userNameH").val()+'&type='+$("#userNameH").attr('a'),		method:"get",		data: "",		async: false,		callback:function(data) {			$("#content").last().after(data);		}	});}function search(){	$("#content").html("");	var type = $("#userName").val() ==  "" ? 2 : 0;	ajaxExt({		url:'/user/listRecordBody?start=0'+'&account='+$("#userName").val()+'&type=' + type,		method:"get",		data: "",		async: false,		callback:function(data) {			$("#content").html(data);		}	});}function seniorSearch(account){	$("#userNameH").val(account).attr('a','2');	$("#content").html("");	ajaxExt({		url:'/user/listRecordBody?start=0'+'&account='+account+'&type='+$("#userNameH").attr('a'),		method:"get",		data: "",		async: false,		callback:function(data) {			$("#content").html(data);			$('.returnBtn').show();		}	});}/** * 下级充值 */function accountRecharge(account){	if ($('#accountRecharge').val()!=1) {		$.alert("您的会员转账功能尚未开通！");		return;	}	ajaxExt({		url:'/user/checkBank',		type:'post',		dataType:'json',		callback:function(rel){			if(rel!=null){				location.href =rel;			}else{				if (showSafeDialog()) {					return;				}				$('#targetUser').val(account);				$('#chargeamount').val("");				$('.userListBox').hide();				$('#setSubordRechBox, .returnBtn').show();//显示下级充值及返回按钮								//用户列表-下级充值形式select对应的右侧提示变化				$('#rechargeStyle option').eq(0).prop('selected',true);				$('#rechargeStyle0').show().siblings().hide();				$('#rechargeStyle').on('change',function(){					var IDname = '#rechargeStyle' + $(this).val();					$(this).attr('data-id',IDname);					$(IDname).show().siblings().hide();				});			}		}	});}function showSafeDialog(){	if($('#userSafeWord').val() == ""||$('#userSafeWord').val() == null){		$.alert("未设置安全密码！");		return true;	}	return false;}function doDownRecharge(){	if ($('#chargeamount').val()=="") {		$('#chargeamount').focus();		return;	}	if ($('#sourceUserSafePassword').val()=="") {		$('#sourceUserSafePassword').focus();		return;	}	if ($('#sourceUserSafePassword').val().length<8) {		$('#sourceUserSafePassword').focus();		return;	}		var remark;	var rechargeStyle = $('#rechargeStyle').val();	if (rechargeStyle == 1) {		remark = "工资";	} else if (rechargeStyle == 2) {		remark = "团队活动";	} else if (rechargeStyle == 3) {		remark = "周期分红";	} else if (rechargeStyle == 4) {		remark = $('#remark').val();		if (remark && remark == "0") {			remark = $("#remarkOtherReasion").val();		}	}	if (!remark) {		$.alert("上级充值必须选择备注原因");		return;	}	if (remark.length > 5) {		$.alert("备注用途不得超过5个字");		return;	}	if (checkHadSpecialChar(remark)) {		$.alert("备注用途不能包含特殊字符！");		return;	}		var param = getQueryParams();	param['remark'] = remark;	Service('/recharge/rechargeLower',"POST",param,1,function(data){		var targetUser = $("#targetUser").val();		$("#rechargeLowerForm")[0].reset();		$("#targetUser").val(targetUser);		$.alert(data);	});}function getQueryParams() {	var p={};	$.each($("#rechargeLowerForm").serializeArray(),function(){          p[this.name]=this.value;      });		return p;}function selectRemark(remark) {	if (remark == "0") {		$("#remarkOtherReasion").show();	} else {		$("#remarkOtherReasion").hide();	}}//显示配额分配function showQuotaDistArea(account,rebateRatio){	$('#quotaDistTable tr:gt(0)').each(function(){		$(this).remove();	});	$('.userListBox').hide();	$('#setQuotaAllotBox, .returnBtn').show();//显示配额分配及返回按钮	$('#quotaUserName').text(account);	$('#myRebateRatio').text(parseFloat(rebateRatio).toFixed(1)+"%");	ajaxExt({		url:'/user/loadQuota?account='+account,		method:"get",		data: "",		async: false,		callback:function(data) {			for(var i = 0;i<data.length;i++){				$('#quotaDistTable').append("<div class='setQuotaAllotDetail'><p><span>该用户此返点</span><span class='fontColorRed reserPointText'>"+data[i].rebateRatio+"%</span><span>的个数为<span class='fontColorRed'>"+data[i].selfNum+"</span>个，此返点的剩余个数为</span><span class='fontColorRed'>"+data[i].num+"</span>" +					"<span>个</span></p><p><span>分配</span><input type='number' class='selfRebateTotal labelCond' name='count' onkeyup='inputNumber(this)'><span>个</span></p></div>");			}		}	});}function inputNumber(obj){	obj.value = obj.value.replace(/\D/g,'');}/** * 分配配额 */function doSetUserQuota(ele){	var args = "[";	$('#quotaDistTable input').each(function(){		if($(this).val() != "" && $(this).val() != undefined){			args += "{\"account\":\""+$('#quotaUserName').text()+"\",\"" +				"rebateRatio\":" + parseFloat($(this).parent().prev().find('.reserPointText').html()) +",\"num\":"+$(this).val()+"},";		}	});	args = args.substring(0,args.length-1);	args += "]";	if(args.length<5){		$.alert('请至少输入一项数据');		return;	}	Service("/down/setQuota","POST",args,2,function(data){		$.alert(data);		//$('#setQuotaAllotBox').hide();		//$('.userListBox').show();	});}/** * 返点调配 */function showQueryRebateArea(account,niceName,rebateRatio,userType,userMinRatio,noneMinRatio){	niceName = niceName==null ? "" : niceName;	$('#rebatePerson').text(account);	$('#rebateNickName').text(niceName);	$('#selfRebateRatio').html("<span class='fontColorRed'>"+parseFloat(rebateRatio).toFixed(1)+"%</span>");	$('.userListBox').hide();	$('#setReservePointBox, .returnBtn').show();//显示返点调配及返回按钮	$("#UserQuota").val(Math.add(parseFloat(rebateRatio),0.1));	var max = Math.sub(parseFloat($('#userRebateRatios').val()),userMinRatio);	if(userType=="0"){		var m = Math.add(userMinRatio,noneMinRatio);		max = max>m?m:max;	}	$('#smart').val(Math.add(parseFloat(rebateRatio),0.1));	$('#bigger').val(max);	/* $("#UserQuota").spinner({min:Math.add(parseFloat(rebateRatio),0.1), max:max, step:0.1}); */}/** * 向下提交返点 */function reduceRebate(){	var smartValue =parseFloat($('#smart').val());	var value = parseFloat($("#UserQuota").val());	if(smartValue < value){		$("#UserQuota").val(Math.sub(value,0.1));	}else{		$.alert('已经是最小返点！');	}}/** * 向上提交返点 */function addRebate(){	var bigValue =parseFloat($('#bigger').val());	var value = parseFloat($("#UserQuota").val());	if(bigValue>value){		$("#UserQuota").val(Math.add(value,0.1));	}else{		$.alert('已经是最大返点！');	}}/** * 修改完成 */function doAdjustQuota(){ //调整用户的返点	var args = "account="+$('#rebatePerson').text()+"&rebateRatio="+$('#UserQuota').val();	Service("/down/adjustQuota","POST",args,1,function(data){		$.alert(data);		//$('.userListBox').show();		//$('#setReservePointBox').hide();	});}function checkMoney(obj) {	var me = obj,v = me.value,index;	me.value = v = v.replace(/^\.$/g, '');	index = v.indexOf('.');	if (index > 0) {		me.value = v = v.replace(/(.+\..*)(\.)/g, '$1');		if(v.substring(index + 1, v.length).length > 2) {			me.value= v  = v.substring(0, v.indexOf(".") + 3);		}	}	me.value = v = v.replace(/[^\d|^\.]/g, '');	me.value = v = v.replace(/^00/g, '0');}