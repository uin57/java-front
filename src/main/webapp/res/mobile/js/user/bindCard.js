$(document).ready(function(){		getCardList();		$("#bindNewCard").click(function(){		var count = 5 - $('.bankCardList>li').length;		if (count == 0) {			return;		}else if (count<5) {			$('.container>div').hide();			$('.historyCardVerify').show();		}else {			safePassword();		}	});});function safePassword(){	$('.container>div').hide();	$('.verifySafePassword').show();}function doNext(){	$('.container>div').hide();	$('.bindCardListBox').show();	if($('#selectBank').children().length == 0){ //首次加载获得银行下拉列表		Service("/info/getBankAll","GET",null,1,function(data){		//$.getJSON("/info/getBankAll",function(data){			$('#selectBank').append("<option value=\"0\">请选择</option>");			for(var i = 0;i<data.length;i++){				$('#selectBank').append("<option value=\""+data[i].id+"\">"+data[i].title+"</option>");			}		});			}	if($('#selectProvince').children().length == 0){ //首次加载获得省份列表		Service("/info/getProvinceAll","GET",null,1,function(data){		//$.getJSON("/info/getProvinceAll",function(data){			$('#selectProvince').append("<option value=\"0\">请选择</option>");			for(var i = 0;i<data.length;i++){				$('#selectProvince').append("<option value=\""+data[i].provid+"\">"+data[i].provname+"</option>");			}		});	}	$('#selectProvince').unbind("change").change(function(){		var args = "provinceId="+$(this).val();		Service("/info/getCity","GET",args,1,function(data){		//$.getJSON("/info/getCity",args,function(data){			$('#selectCity').empty();			$('#selectCity').append("<option value=\"0\">请选择城市</option>");			for(var i = 0;i<data.length;i++){				$('#selectCity').append("<option value=\""+(i+1)+"\">"+data[i].cityname+"</option>");			}		});	});}function BindCardconfirm(){		if($('#selectBank option:selected').val() == "0"){		$.alert("请选择开户银行");		return;	}	if($('#selectProvince option:selected').val() == "0"){		$.alert("请选择开户银行区域");		return;	}	if($('#selectCity option:selected').val() == "0"){		$.alert("请选择开户银行城市");		return;	}		if($('#address').val() == ""){		$('#address').attr("placeholder","请输入支行名称");		$('#address').focus();		return;	}	if($('#niceName').val() == ""){		$('#niceName').attr("placeholder","请输入开户人姓名");		$('#niceName').focus();		return;	}	if($('#card1').val() == ""){		$('#card1').attr("placeholder","请输入银行卡号");		$('#card1').focus();		return;	}	var cardValid = /\d{16,19}/g;	if(!cardValid.test($('#card1').val())){		$('#card1').focus();		return;	}	if($('#card').val() != $('#card1').val()){		$('#card').val("");		$('#card').attr("placeholder","银行卡号输入不一致");		$('#card').focus();		return;	}		$('.container>div').hide();	$('.bindCardAfmInfoBox').show();	$('.bindAfmInfoTable tr:eq(0) td:eq(0)').text($('#selectBank option:selected').text());	$('.bindAfmInfoTable tr:eq(1) td:eq(0)').text($('#selectProvince option:selected').text());	$('.bindAfmInfoTable tr:eq(2) td:eq(0)').text($('#selectCity option:selected').text());	$('.bindAfmInfoTable tr:eq(3) td:eq(0)').text(document.getElementById("address").value);	$('.bindAfmInfoTable tr:eq(4) td:eq(0)').text(document.getElementById("niceName").value);	$('.bindAfmInfoTable tr:eq(5) td:eq(0)').text(document.getElementById("card").value);}function inputNumber(obj){	obj.value = obj.value.replace(/\D/g,'');}function backup(){	$('.container>div').hide();	$('.bindCardListBox').show();}function doBindCard(){	var address = $('#selectProvince option:selected').text() + $('#selectCity option:selected').text();	var d = serializeObject('#newBindCard');	d.address = address+d.address;	d.address = d.address.replace(/\s+/g,"");		var oldCardInfo = serializeObject('#verifyCard');		//验证数据和新数据合并	for(var n in oldCardInfo){		d[n] = oldCardInfo[n];	}		ajaxExt({		url:'/user/bindCard',		type:'post',		dataType:'json',		data:d,		callback:function(data){			$.alert({text:data,icon:'ok'});			document.getElementById("verifyCard").reset();			$('.container>div').hide();			$('.bankCardListBox').show();			getCardList();		}	});}function getCardList(){	Service("/user/showCard","GET",null,1,function(data){		var count = 5 - data.length;		$("#bindedBankCardNum").text(count);		$('.bankCardList>li').each(function(){			$(this).remove();		});		$('#selectHistoryCard').append("<option value=\"0\">请选择</option>");		for (var i = 0; i < data.length; i++) {			$('#selectHistoryCard').append("<option value=\""+data[i].id+"\">************"+data[i].card+"</option>");			var li = $("<li class=\"bankCardDetail\"></li>");			var img = $("<img class=\"bankIcon\" alt=\"\" />");			switch (data[i].bankNameId) {			case 1:				$(img).attr("src","/res/mobile/images/bank/icbc.png");				break;			case 2:				$(img).attr("src","/res/mobile/images/bank/boc.png");				break;			case 3:				$(img).attr("src","/res/mobile/images/bank/abc.png");				break;			case 4:				$(img).attr("src","/res/mobile/images/bank/ccb.png");				break;			case 5:				$(img).attr("src","/res/mobile/images/bank/upop.png");				break;			case 6:				$(img).attr("src","/res/mobile/images/bank/upop.png");				break;			case 7:				$(img).attr("src","/res/mobile/images/bank/bea.png");				break;			case 8:				$(img).attr("src","/res/mobile/images/bank/bjrcb.png");				break;			case 9:				$(img).attr("src","/res/mobile/images/bank/bob.png");				break;			case 10:				$(img).attr("src","/res/mobile/images/bank/cbhb.png");				break;			case 11:				$(img).attr("src","/res/mobile/images/bank/ceb.png");				break;			case 12:				$(img).attr("src","/res/mobile/images/bank/cib.png");				break;			case 13:				$(img).attr("src","/res/mobile/images/bank/citic.png");				break;			case 14:				$(img).attr("src","/res/mobile/images/bank/cmb.png");				break;			case 15:				$(img).attr("src","/res/mobile/images/bank/cmbc.png");				break;			case 16:				$(img).attr("src","/res/mobile/images/bank/comm.png");				break;			case 17:				$(img).attr("src","/res/mobile/images/bank/czb.png");				break;			case 18:				$(img).attr("src","/res/mobile/images/bank/gdb.png");				break;			case 19:				$(img).attr("src","/res/mobile/images/bank/gzcb.png");				break;			case 20:				$(img).attr("src","/res/mobile/images/bank/hsb.png");				break;			case 21:				$(img).attr("src","/res/mobile/images/bank/hxb.png");				break;			case 22:				$(img).attr("src","/res/mobile/images/bank/hzb.png");				break;			case 23:				$(img).attr("src","/res/mobile/images/bank/nbcb.png");				break;			case 24:				$(img).attr("src","/res/mobile/images/bank/njcb.png");				break;			case 25:				$(img).attr("src","/res/mobile/images/bank/psbc.png");				break;			case 26:				$(img).attr("src","/res/mobile/images/bank/sdb.png");				break;			case 27:				$(img).attr("src","/res/mobile/images/bank/shb.png");				break;			case 28:				$(img).attr("src","/res/mobile/images/bank/spa.png");				break;			case 29:				$(img).attr("src","/res/mobile/images/bank/spdb.png");				break;			case 30:				$(img).attr("src","/res/mobile/images/bank/srcb.png");				break;			case 31:				$(img).attr("src","/res/mobile/images/bank/upop.png");				break;			default:				$(img).attr("src","/res/mobile/images/bank/upop.png");				break;			}			var div = $("<div class=\"bankCardInfo\"><p>"+data[i].niceName+"</p><p class=\"fontColorGray\">************"+data[i].card+"</p></div>");			$(li).append(img);			$(li).append(div);			$('.bankCardList').append(li);		}		if (count == 0) {			$("#bindNewCard").addClass("backPrev");		}else {			$("#bindNewCard").removeClass("backPrev");		}	},false);}function checkOldCard(){		if($('#selectHistoryCard option:selected').val() == "0"){		$.alert("请选择要验证的银行卡");		return;	}	if($($($('#verifyCard').children()[1]).children()[1]).val() == ""){		$($($('#verifyCard').children()[1]).children()[1]).attr("placeholder","请输入开户人姓名");		$($($('#verifyCard').children()[1]).children()[1]).focus();		return;	}	if($($($('#verifyCard').children()[2]).children()[1]).val() == ""){		$($($('#verifyCard').children()[2]).children()[1]).attr("placeholder","请输入银行卡号");		$($($('#verifyCard').children()[2]).children()[1]).focus();		return;	}	if($($($('#verifyCard').children()[3]).children()[1]).val() == ""){		$($($('#verifyCard').children()[3]).children()[1]).attr("placeholder","请输入安全密码");		$($($('#verifyCard').children()[3]).children()[1]).focus();		return;	}		var args = $('#verifyCard').serialize();	Service("/user/checkOldCard","POST",args,1,function(data){		if(data.valid == 0){			$.alert("验证信息不正确");			return;		}		doNext();	});}function verifySafePassword(){	$("#errorSpan").html("");	var safePassword = $("#safePassword").val();	if (!safePassword) {		$.alert('请输入安全密码');		return false;	}	ajaxExt({		url: '/user/verifySafePassword',		type: 'post',		dataType: 'json',		data: {"safePassword": safePassword},		callback: function (rel) {			$("#safeWord").val(safePassword);			doNext();		}	});}