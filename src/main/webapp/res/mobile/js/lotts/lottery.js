$(function() {	//玩法列表收展	$('#currPlayMethod').click(function(){		if( $('#playMethodGroupList').is(':visible') ){			$(this).removeClass('active');		} else {			$(this).addClass('active');		}		$('#playMethodGroupList').slideToggle();	});	//切换玩法	$(".playMethod").click(function(){		$(".playMethod").removeClass("active");		$(this).addClass("active");		$("#playName").text($(this).attr("data-parent") + $(this).text());		var show = $(this).attr("data-show");		$(".betsChangeNumBox").hide();		$(show).show();		$(".changeNumContent a").removeClass("active");		$('#currPlayMethod').removeClass('active');		$('#playMethodGroupList').slideUp();		refererPage();	});	//玩法介绍	$('.betsPlaysIntroDetail').click(function(){		$('.betsChangeNumTips').show();		$('#mask').after($('#mask').clone(true).attr('id', 'betsPlaysIntro'));		$('#betsPlaysIntro').attr('onclick', 'closePlaysIntro()').css('z-index', '999').show();	});	//任选切换位置	$(".anySelect").change(function(){		refererPage();	});	// 选号快捷按钮	$("a.changeNumBtn").click(function() {		var mm = $(this);		var a = mm.parents(".changeNumDetail").find(".changeNumContent a");		a.removeClass("active"); // 清		if (mm.hasClass("numBtnAll")) {			a.addClass("active"); // 全		} else if (mm.hasClass("numBtnBig")) {			a.filter(":gt(4)").addClass("active"); // 大 前5个算小。其他算大		} else if (mm.hasClass("numBtnSmall")) {			a.filter(":lt(5)").addClass("active"); // 小 前5个算小。其他算大		} else if (mm.hasClass("numBtnOdd")) {			// 单			if (a.first().attr("data-num") == '1' || a.first().attr("data-num") == '01') {				a.filter(":even").addClass("active");			} else {				a.filter(":odd").addClass("active");			}		} else if (mm.hasClass("numBtnEven")) {			// 双			if (a.first().attr("data-num") == '1' || a.first().attr("data-num") == '01') {				a.filter(":odd").addClass("active");			} else {				a.filter(":even").addClass("active");			}		}		refererPage();	});	// 号码选择	$(".changeNumContent a").click(function() {		if($(this).hasClass("active")) {			$(this).removeClass("active");			return false;		}				var parentDiv = $(this).parent();//		var max = ~~parentDiv.attr("data-max");//		if(isSingle == 'true'){//			parentDiv.find("a").removeClass("active");//			$(this).addClass("active");//		}else{//			$(this).toggleClass("active");//		}				var maxSelect =~~ parentDiv.attr("data-max");		if(maxSelect > 0 ){			var num = parentDiv.find("a.active").length;			if(num>=maxSelect) {				var last = parentDiv.attr("data-last");				parentDiv.find("a[data-num='"+last+"']").removeClass("active");			}		}		$(this).addClass("active");		var n = $(this).attr("data-num");		parentDiv.attr("data-last",n);				refererPage();	});		//单式文本框	$(".singleTextArea").blur(function(){		var t = $(this).val();		t = $.trim(t);		$(this).val(t);	});		$(".singleTextArea").keyup(function(){		refererPage();	});	//清空号码盘里的数据	$(".clearChangeNum").click(function(){		$(".changeNumContent a").removeClass("active");		refererPage();	});	// 圆角切换	$(".betsTypeBtns a").click(function() {		$(".betsTypeBtns a").removeClass("active");		$(this).addClass("active");		refererPage();	});	// 添加号码蓝	$("#joinBetsBar").click(function() {		var info = getSelectInfo();		if (info.count == 0) {			if($("#selectBetPanle>div.betsNumInfo").length<1){				$.alert("您尚未选定一个完整的投注");				return;			}		}		$('#lotteryBetsBox').hide();		$('#cfmBetsBox').show();		if (info.count == 0)  return;		addToList(info);	});	//随机注数	$(".createRandom").click(function(){		var num = parseInt($(this).attr("data-count"));		var play = $(".playMethod.active");		var playId = play.attr("data-show");		var pId = playId.substring(1);				//玩法ID		var playTitle = play.attr("data-title"); 	//玩法名称		for(var n =0;n<num;n++){			try{				var info = lottery.runRandom(pId);				info.title = playTitle;				addToList(info);			}catch(e){				$.alert("该玩法不支持随机生成!");			}		}	});	//继续选号	$('#changeAgainBtn').click(function(){		$('#lotteryBetsBox').show();		$('#cfmBetsBox').hide();	});	// 删除当前注单	$(document).on("click", "a.clearCurrBetsNum", function() {		$(this).parent().remove();		refererPage();	});	// 清空已选号码	$("#betsNumShowClear").click(function() {		$("#selectBetPanle").html("");		refererPage();	});	//倍数变更	$("#betPrice").blur(function(){		//if(this.value>9999) this.value = 9999;		if(this.value<1) this.value = 1;		refererPage();	});	//追号期数变更	$("#tracePrice").blur(function(){		if(this.value>200) this.value = 200;		if(this.value<1) this.value = 1;		refererPage();	}).keyup(function(){		if(this.value > 1){			$('#betsAppNumBox').show();		} else {			$('#betsAppNumBox').hide();		}	});	// 投注确认	$("#betConfirm").click(function() {		function setHtml(isTrace,betPrice,seasonList){			var allCount = 0;			var allAmount = 0;			var i = 0;			var winStop = $("#winStop").is(":checked")?1:0;			var formInputs = '<input type="hidden" name="isTrace" value="'+isTrace+'"/>';			winStop = isTrace == 0 ? 0 : winStop;			formInputs += '<input type="hidden" name="traceWinStop" value="'+winStop+'"/>';			formInputs += '<input type="hidden" name="bounsType" value="0"/>';  //高奖			$("#selectBetPanle>div.betsNumInfo").each(function() {				var id = $(this).attr("data-id"); // 玩法				var content = $(this).attr("data-content"); // 内容				var count =parseInt( $(this).attr("data-count")); // 注数				var amount = parseFloat($(this).attr("data-amount")); // 单注金额				var unit = $(this).attr("data-unit"); // 单价				allCount = allCount.add(count);				allAmount = allAmount.add(amount.mul(betPrice));				formInputs += '<input type="hidden" name="order[' + i + '].playId" value="'+id+'"/>';				formInputs += '<input type="hidden" name="order[' + i + '].content" value="'+content+'"/>';				formInputs += '<input type="hidden" name="order[' + i + '].betCount" value="'+count+'"/>';				formInputs += '<input type="hidden" name="order[' + i + '].price" value="'+betPrice+'"/>';				formInputs += '<input type="hidden" name="order[' + i + '].unit" value="'+unit+'"/>';				i++;			});			for(var n in seasonList){				var seasonId = seasonList[n];				formInputs += '<input type="hidden" name="traceOrders['+n+'].seasonId" value="'+seasonId+'"/>';				formInputs += '<input type="hidden" name="traceOrders['+n+'].price" value="'+betPrice+'"/>';			}			var seasonText = '';			var showCount = allCount;			if(seasonList.length>1){				showCount = showCount.mul(seasonList.length);				allAmount = allAmount.mul(seasonList.length);				seasonText = seasonList[0]+" 至 "+seasonList[seasonList.length-1];			} else {				seasonText = seasonList[0];			}			formInputs += '<input type="hidden" name="count" value="'+allCount+'"/>';			$("#betConfirmForm").html(formInputs);			$("#betConfirmAmount").text(allAmount);			$("#betConfirmTrace").text(seasonList.length);			$("#betConfirmNum").text(showCount);			$("#betConfirmPrice").text(betPrice);			$("#betConfirmTraceList").text(seasonText);			$.dialog("#betConfirmBox");		}		if($("#selectBetPanle>div.betsNumInfo").length<1){			$.alert("请选择号码后投注,您未选择号码");			return;		}		var betPrice = parseInt($("#betPrice").val()); //倍数		var tracePrice = parseInt($("#tracePrice").val()); //期数		if(isNaN(betPrice)){			$.alert("请填写您要投注的倍数");			return;		}		if(isNaN(tracePrice)){			$.alert("请填写您要投注的期数");			return;		}		var isTrace = 0;		var seasonList = [];		if(tracePrice>1) {			isTrace = 1;			ajaxExt({				url : 'listTraceSeasonId?count=' + tracePrice,				callback : function(rel) {					for ( var n in rel) {						var index = parseInt(n);						seasonList[index] = rel[index].seasonId;					}					setHtml(isTrace,betPrice,seasonList);				}			});		} else {			seasonList[0] = $("#saleSeasonId").text();			setHtml(0,betPrice,seasonList);		}	});	//投注提交	$("#betSubmit").click(function(){		var a = $(this);		if (a.hasClass('disabled')){			return;		}		a.addClass("disabled");		ajaxExt({			url:'bet',			method:"POST",			data: $("#betConfirmForm").serialize(),			callback:function(rel) {				$("#selectBetPanle").html("");				//清空代投列表				$(".changeNumContent a").removeClass("active");		//清空号码盘数据				refererPage();//				$("#refererUser").click();					//刷新余额				$.alert({text:"恭喜您，投注成功！", icon:'ok'});			},			complete:function(){				a.removeClass("disabled");			}		});	});	$('body').everyTime('1s', 'A', refererTime); //1秒	$('body').everyTime('1das','B',getInfo);	 //10秒	// 默认选择的菜单//	$('#currPlayMethod').click();	$("a.playMethod[data-show='#"+ lottery.defaultPlayer +"']").click();//	$(".playMethod").removeClass("active");//	$(currentA).addClass("active");////	$("#playName").text($(currentA).attr("data-parent") + $(currentA).text());////	var show = $(currentA).attr("data-show");//	$(".betsChangeNumBox").hide();//	$(show).show();});//关闭玩法介绍及遮罩function closePlaysIntro(){	$('.betsChangeNumTips').hide();	$('#betsPlaysIntro').remove();}function numberFormat(n) {	if (n < 10)		return "0" + n;	else		return n;}// 倒计时function refererTime() {	var allSecond = parseInt($("#saleAllSecond").attr("data-second"));	allSecond -= 1;	if (allSecond >= 0) {		var hour = parseInt(allSecond / 3600);		var minute = parseInt((allSecond % 3600) / 60);		var second = parseInt(allSecond % 60);		$("#saleAllSecond").attr("data-second", allSecond);		var t = numberFormat(hour) + ":" + numberFormat(minute) + ":"				+ numberFormat(second);		$(".saleHour").text(numberFormat(hour));		$(".saleMintue").text(numberFormat(minute));		$(".saleSecond").text(numberFormat(second));		//$(".seasonTime").text(t);	}	if (allSecond <= 0) {		getInfo();	}}// 获取最新数据function getInfo() {	ajaxExt({		loading:'',		noError:true,		url : 'info',		callback : function(data) {			var amount = data.amount.toFixed(4);			$(".userBalance").text(amount);			$("#saleAllSecond").attr("data-second", data.allSecond); // 销售时间			//更新开奖号码			var openSeasonId = $(".lastSeasonId:first").text();			if(openSeasonId != data.lastOpen.seasonId){				$('.lastSeasonId').text(data.lastOpen.seasonId);				var lastSeasonNum = data.lastOpen.nums;				$('.lastSeasonNum').html('');				$(lastSeasonNum).each(function(){					$('.lastSeasonNum').append('<span>' + this + '</span>');				});			}			var saleSeasonId = $(".saleSeasonId:first").text();						if (data.seasonId != saleSeasonId) {				$(".saleSeasonId").text(data.seasonId); 	// 销售期号				$.alert("<span class='fontColorCyan fontBold'>" + saleSeasonId + "</span>期 已截止销售,<br/>当前期为<span class='fontColorCyan fontBold'>"+data.seasonId+"</span>期 ，请留意！");			}			// 中奖通知			var userNotice = data.userNotice;			//userNotice 的格式 [{id,account,content,createTime,status},....]			if (userNotice.length) {				$(userNotice).each(function(){					//每2.6秒弹出一个中奖窗口，避免重叠					var currAwardTime = $(userNotice).index($(this)) * 26 + 'ds';					$(this).oneTime(currAwardTime, function(){						var text = this.content;						var win = this.win;						if(win > 0){							var content = "<span style='font-size: 24px;vertical-align: middle;'>中奖啦！</span>";							content += "<br/><span style='display: inline-block;margin-top: 15px;'>" + text + "</span>";							$.alert({text: content, icon: 'ok'});						}else{							var content = "<span style='font-size: 24px;vertical-align: middle;'>未中奖！</span>";							content += "<br/><span style='display: inline-block;margin-top: 15px;'>" + text + "</span>";							$.alert(content);						}					});				});			}		}	});}//添加到待投列表function addToList(info){	if((info.err && info.err!='') || (info.cf && info.cf!='')){		$.alert("自动删除重复与错误项,请检查并确认");	}		var unitTxt = $(".betsTypeBtns a.active").text(); // 元、角	var unit = parseFloat($(".betsTypeBtns a.active").attr("data-unit")); // 圆角分金额	var amount = unit.mul(info.count); // 总额（单注）		var xml = '<div class="betsNumInfo" data-amount="'			+ amount + '" data-content="' + info.content			+ '" data-count="' + info.count + '" data-id="'			+ info.id + '" data-unit="' + unit + '">';	xml += '<a href="javascript:;" class="clearCurrBetsNum"></a>';	xml += '<div class="betsNumDetail">';	xml += '<p class="betsNum overflowEllipsis">' + info.content + '</p>';	xml += '<p class="betsNumIntro">';	xml += '<span>' + info.title + '</span>';	xml += '<label>';	xml += '<span class="fontColorYellow">' + info.count + '</span>';	xml += '<span>注X</span>';	xml += '<span>'+unit+'</span>';	xml += '<span>元=</span>';	xml += '<span class="fontColorYellow">' + amount + '</span>';	xml += '<span>元</span>';	xml += '</label>';	xml += '</p>';	xml += '</div>';	xml += '</div>';	$("#selectBetPanle").prepend(xml);	$("a.changeNum").removeClass("active");	$(".singleTextArea").val("");	refererPage();}function singleDelete(content){	if(content){		if(content.indexOf("|")>0){			content = content.substring(content.indexOf("|")+1);		}	}	return content;}// 获取号码盘的信息function getSelectInfo() {		var play = $(".playMethod.active");		var playId = play.attr("data-show"); // 玩法ID	var playTitle = play.attr("data-title"); //玩法名称	var allText = "";	// 号码盘	$(playId).find(".changeNumContent").each(function(k, v) {		var a = $(this).find("a.active");		if (a.length == 0) {			allText += "|-";		} else {			var t = "";			a.each(function(n, m) {				var num = $(this).attr("data-num");				t += "," + num;			});			allText += "|" + t.substring(1);		}	});		//任选	var anySelect = $(playId).attr("data-anySelect");	var selectNum = 1;	var mustNum = 1;	var title = '';	if(anySelect!=''){		var selInput = $(playId).find("input.anySelect:checked");		selectNum = selInput.length;		mustNum = parseInt(anySelect);		if(selectNum>=anySelect){			selInput.each(function(){				title+=$.trim($(this).val());			});			title+="|";		}	}			var info = null;	var pId = playId.substring(1);	if(allText != ''){		//复式		allText = allText.substring(1);		info = lottery.run(pId, allText);	} else {		//单式		allText = $(playId).find(".singleTextArea").val();		allText = singleDelete(allText);		info =  lottery.run(pId, allText);//		if(allText==''){//			$(playId).find(".singleMsg").show();//		} else{//			$(playId).find(".singleMsg").hide();//		}	}		info.title = playTitle;	info.content = title+ info.content;	info.count = info.count.mul(lottery.combin(selectNum,mustNum));	return info;}// 刷新信息,选号的统计数据function refererPage() {	//正在选的号码盘的信息	var info = getSelectInfo();	var unit = parseFloat($(".betsTypeBtns a.active").attr("data-unit")); // 单价，圆角模式	var amount = unit.mul(info.count); // 总额度	$("#betsCount").text(info.count);	$("#betsAmountCount").text(amount);	//已选的信息	var allCount = 0;	var allAmount = 0;	$("#selectBetPanle>div").each(function() {		allCount = allCount.add(parseInt($(this).attr("data-count")));		allAmount = allAmount.add(parseFloat($(this).attr("data-amount")));	});		var price = parseInt($("#betPrice").val()); // 倍数	if (isNaN(price) || price<1) {		price = 1;		$("#betPrice").val(price);	}		var tracePrice = parseInt($("#tracePrice").val()); // 期数	if (isNaN(tracePrice) || tracePrice<1) {		tracePrice = 1;		$("#tracePrice").val(tracePrice);	}		$("#appNumCount").text(allCount.mul(tracePrice));	$("#appNumAmount").text(allAmount.mul(price).mul(tracePrice));}