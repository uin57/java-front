var endAnimateCont = true;//开奖动画停止必需var lastEndAnimate = true;//开奖动画到最后一个号码才弹框var animateVersion = true;//true,时间到开启动画,开奖时停止;false,开奖时才开启动画var fireCount = 1;//火焰效果倍数增加计数器var fireOff = false;//火焰效果开关，false为关闭function numberFormat(n) {	if (n < 10)		return "0" + n;	else		return n;}//显示隐藏可输入下拉框function inputSelectFrame(ele) {	var inputOptions = $(ele).next();	$(inputOptions).is(':hidden') ? $(inputOptions).show() : $(inputOptions).hide();	$(ele).parent().hover(function(){},function(){		$(inputOptions).hide();	});}//选择并赋值function inputSelectConfirm(ele) {	$(ele).parent().prev().prev().val(ele.innerHTML);	refererPage();	inputSelectFrame($(ele).parent().prev());}//减少倍数function reduceMult() {	var betPrice = $('#betPrice').val();	if (betPrice > 1) {		$('#betPrice').val( betPrice - 1 );		refererPage();	}}//增加倍数function addMult() {	var betPrice = $('#betPrice').val();	//if (betPrice < 9999) {		$('#betPrice').val( parseInt(betPrice) + 1 );		refererPage();		//火焰效果：当计数器大于3时显示		if (fireOff) {			++fireCount;			if (fireCount > 3 && fireCount < 15) {				if (fireEffectCount) {					//第一次只显示火焰,通过fireEffectCount来判断是否为第一次					fireEffect();//fire effect					fireEffectCount = false;				} else {					//之后调整画布大小，来使火焰变大					var fireBox = $("#surface"),						fireWidth = fireBox.width() + 2,						fireHeight = fireBox.height() + 4,						fireLeft = parseInt(fireBox.css('left')) - 1;					fireBox.css({						width: fireWidth,						height: fireHeight,						left: fireLeft					});				}			}		}	//}}function singleDelete(content){	if(content){		if(content.indexOf("|")>0){			content = content.substring(content.indexOf("|")+1);		}	}	return content;}// 获取号码盘的信息function getSelectInfo() {	var play = $($(".lottNavDetail.active").attr('data-show')).find(".lottTypeDetail.active");// 当前玩法组		var playId = play.attr("data-show"); // 玩法ID	var playTitle = play.attr("data-title"); // 玩法名称	var allText = "";		// 号码盘	$(playId).find(".numList").each(function(k, v) {		var a = $(this).find("a.active");		if (a.length == 0) {			allText += "|-";		} else {			var t = "";			a.each(function(n, m) {				var num = $(this).attr("data-num");				t += "," + num;			});			allText += "|" + t.substring(1);		}	});			var anySelect = $(playId).attr("data-anySelect");	var selectNum = 1;	var mustNum = 1;	var title = '';	if(anySelect!=''){		var selInput = $(playId).find("input.anySelect:checked");		selectNum = selInput.length;		mustNum = parseInt(anySelect);		if(selectNum>=anySelect){			selInput.each(function(){				title+=$.trim($(this).val());			});			title+="|";		}	}		var info = null;	var pId = playId.substring(1);	if(allText != ''){		//复式		allText = allText.substring(1);		info = lottery.run(pId, allText);	} else {		//单式		allText = $(playId).find(".singleNum").val();		allText = singleDelete(allText);				info =  lottery.run(pId, allText);		if(allText==''){			$(playId).find(".singleMsg").show();		} else{			$(playId).find(".singleMsg").hide();		}	}	info.title = playTitle;	info.content = title+ info.content;	info.count = info.count.mul(lottery.combin(selectNum,mustNum));	return info;}// 刷新信息,选号的统计数据function refererPage() {	var info = getSelectInfo();	var unit = parseFloat($("a.amountType.active").attr("data-unit")); // 单价，圆角分模式	var price = parseInt($("#betPrice").val()); // 倍数	if ( $("#betPrice").val() == "" ) price = 0;	var amount = price.mul(info.count).mul(unit); // 总额度	$("#betsCount").text(info.count);	$("#betsPriceCount").text(price);	$("#betsAmountCount").text(amount);	var allCount = 0;	var allAmount = 0;	$("#selectBetPanle tr").each(function() {		allCount = allCount.add(parseInt($(this).attr("data-count")));		allAmount = allAmount.add(parseFloat($(this).attr("data-amount")));	});	$("#appNumCount").text(allCount);	$("#appNumAmount").text(allAmount);}//刷新追号面板function referereTrace() {	var allMoney = 0;	var allNum = 0;	$(".appendBox:visible .traceList tr.listDetail").each(function() {		var seasonId = $(this).find("input[name='seasonId']");		if (seasonId.is(":checked")) {			var price = $(this).find("td:eq(3)").attr("data-price");			allMoney = allMoney.add(parseFloat(price));			allNum += 1;		}	});	var count = parseInt($("#traceBox").attr("data-count"));		var allCount = allNum.mul(count);	$("#traceAllNum").text(allNum);			//期数	$("#traceAllCount").text(allCount);		//注数	$("#traceAllMoney").text(allMoney);		//总额}//追号投注列表function refererTraceList(traces,isAppend){	}//刷新我的投注function refererBetList(bets,isAppend){	var tr = "";	for ( var n in bets) {		var bet = bets[n];		var unitTxt = '元';		if (bet.unit == 0.2) {			unitTxt = '角';		} else if (bet.unit == 0.02) {			unitTxt = '分';		} else if(bet.unit == 0.002){			unitTxt = '元';		}		//投注时间只取时间段，去掉年月日		var aTime = bet.createTime.split(' ');		tr += '<tr class="lottInfoDetail">';		tr += '<td>' + aTime[1] + '</td>';		tr += '<td>' + bet.lotteryName + '</td>';		tr += '<td>【' + bet.playName + '】</td>';		tr += '<td class="lottInfoNum overflowEllipsis" title="' + bet.content + '">' + bet.content + '</td>';		tr += '<td>' + bet.price + '倍</td>';		tr += '<td>' + unitTxt + '</td>';		tr += '<td>￥' + bet.amount + '元</td>';		tr += '<td>' + bet.openNum + '</td>';		tr += '<td class="fontColorTheme">';		if (bet.status == 1) {			tr += '￥' + bet.win + '元';		}		tr += "</td>";		tr += '</tr>';	}	if(isAppend){		$("#betTable").prepend(tr);	//加到前面		$("#betTable .lottInfoDetail:gt(9)").remove();	} else {		$("#betTable").html(tr);	//全部替换	}	//原开奖列表	/*	var openNum = bets[0].openNum;	var dl = "";	var q3 = getOpenStatus(openNum, 0, 1, 2);	var h3 = getOpenStatus(openNum, 2, 3, 4);	dl += '<dl class="beforeLottItem">';	dl += '<dt>' + openNum +  '</dt>';	if (q3 == 1) {		dl += '<dd class="leopard">豹子</dd>';	} else if (q3 == 2) {		dl += '<dd class="groupThree">组三</dd>';	} else if (q3 == 3) {		dl += '<dd class="groupSix">组六</dd>';	}	if (h3 == 1) {		dl += '<dd class="leopard">豹子</dd>';	} else if (h3 == 2) {		dl += '<dd class="groupThree">组三</dd>';	} else if (h3 == 3) {		dl += '<dd class="groupSix">组六</dd>';	}	dl += '</dl>';	$("#openStatusTable").after(dl);	//$("#openStatusBox .beforeLottItem:gt(10)").remove();	*/	var openNum = '<li class="openedNumDetail">' + bets[0].openNum + '</li>';	$("#openedNum").prepend(openNum);//新开奖列表	$("#openedNum .openedNumDetail:gt(2)").remove();}function getOpenStatus(data, i1, i2, i3) {	var openNums = data.split(',');	var n1 = ~~openNums[i1];	var n2 = ~~openNums[i2];	var n3 = ~~openNums[i3];	if (n1 == n2 && n1 == n3) {		return 1;	} else if (n1 == n2 || n1 == n3 || n2 == n3) {		return 2;	} else {		return 3;	}}$(function() {	//初始化开奖号码和位置	//var h = $('.lottNumDetail p:first').height();	//$('.lottNumDetail').each(function(){	//	$(this).find('p:first').addClass('active');	//	var index = $(this).find('p').index($(this).find('p.active'));	//	$(this).css('margin-top', index * -h);	//});	//左侧浮动显示隐藏	$('#asideLeft h3').click(function(){		$(this).siblings('.allGameList').toggle();	});	//切换玩法群	$(".lottNavDetail").click(function(){		if ($(this).hasClass("active")) {			return;		}		$(".lottNavDetail").removeClass("active");		$(this).addClass("active");		var hide = $(this).attr("data-hide");		var show = $(this).attr("data-show");		$(hide).hide();		$(show).show();				if (show.length > 6) {			var g = show.substring(0, 6);			if (g == '#group') {				$(show + " .lottTypeDetail:first").click();			}		}		$(".numList a").removeClass("active");		$(".singleNum").val('');		refererPage();	});	// 玩法切换	$(".lottTypeDetail").click(function() {		if ($(this).hasClass("active")) {			return;		}		$(".lottTypeDetail").removeClass("active");		$(this).addClass("active");		var hide = $(this).attr("data-hide");		var show = $(this).attr("data-show");		$(hide).hide();		$(show).show();		if($(this).is("[data-example]")){			$("#playRemark").html($(this).attr("data-remark"));			$("#playExample").html($(this).attr("data-example"));			var bonus = null;			if($("#bounsType").val() == 1){				bonus = $(this).attr("data-bonus");			} else {				bonus = $(this).attr("data-MaxBonus");			}			$("#playBonus").html(bonus);		}		$(".numList a").removeClass("active");		$(".singleNum").val('');		refererPage();	});		//任选切换位置	$(".anySelect").change(function(){		refererPage();	});		//冷热切换	$(".hotspot").click(function(){		if($(this).hasClass("active")) return;		$(this).addClass("active");		$(".omit").removeClass("active");		$(".hotspotIssue").show();		$(".host30,.host50,.host100,.lost").hide();		var len = $(".Issue.active").attr("data-len");		$(".host"+len).show();	});		//遗漏切换	$(".omit").click(function(){		if($(this).hasClass("active")) return;		$(this).addClass("active");		$(".hotspot").removeClass("active");		$(".hotspotIssue").hide();		$(".host30,.host50,.host100,.lost").hide();		$(".lost").show();	});		//冷热长度切换	$(".Issue").click(function(){		if($(this).hasClass("active")) return;		$(".Issue").removeClass("active");		$(this).addClass("active");		var len = $(this).attr("data-len");		$(".host30,.host50,.host100,.lost").hide();		$(".host"+len).show();	});		//记录切换	$(".lottInfoNavDetail").click(function(){		if ($(this).hasClass("active")) {			return;		}		$(".lottInfoNavDetail").removeClass("active");		$(this).addClass("active");		var hide = $(this).attr("data-hide");		var show = $(this).attr("data-show");		$(hide).hide();		$(show).show();	});	// 号码选择	$(".numList a").click(function() {//		var isSingle = $(this).parents(".numList").attr("data-single");//		if(isSingle == 'true'){//			$(this).parents(".numList").find("a").removeClass("active");//			$(this).addClass("active");//		}else{//			$(this).toggleClass("active");//		}//		refererPage();						if($(this).hasClass("active")) {			$(this).removeClass("active");			return false;		}		var line = $(this).parents(".numList");		var maxSelect =~~ line.attr("data-max");		if(maxSelect > 0 ){			var num = line.find("a.active").length;			if(num>=maxSelect) {				var last = line.attr("data-last");				line.find("a[data-num='"+last+"']").removeClass("active");			}		}		$(this).addClass("active");		var n = $(this).attr("data-num");		line.attr("data-last",n);		refererPage();	});		//返奖模式切换	$("#bounsType").change(function(){		var bonus = null;		var play = $(".lottTypeDetail.active");		if($("#bounsType").val() == 1){			bonus = play.attr("data-bonus");		} else {			bonus = play.attr("data-MaxBonus");		}				$("#playBonus").html(bonus);	});	// 圆角分切换	$("a.amountType").click(function() {		$("a.amountType").removeClass("active");		$(this).addClass("active");		refererPage();	});	// 倍数变更	$("#betPrice,#traceNum,.inputSelectDiv .labelCond[id*=tracePrice]").keyup(function() {		//if ( this.value > 9999 ) this.value = 9999;		refererPage();	});	$("#betPrice,#traceNum,.inputSelectDiv .labelCond[id*=tracePrice]").blur(function() {		if( this.value == "" || this.value < 1 ) this.value = 1;		refererPage();	});	//清除火焰效果	if (fireOff) {		$('.addMult').hover(function () {			//重置开关，使下次hover时，增加三次倍数可以重新显示火焰效果			fireEffectCount = true;			$('.fireBox').append("<canvas class='fire' id='surface'></canvas>");		}, function () {			//清除火焰效果			cancelAnimationFrame(timeout);			//重置倍数计数器			fireCount = 1;			//清除画布			var fireEle = document.querySelector('#surface'),				fireEffect = fireEle.getContext('2d');			fireEffect.clearRect(0, 0, fireEle.width, fireEle.height);			//重置画布的位置			$(fireEle).remove();		});	}	//导入注单	$(".uploadFile").click(function(){		$("#file").click();	});		//注单提交	$(document).on("change","#file",function(){		// 上传文件		$.ajaxFileUpload({			url : 'upload',// 处理文本			secureuri : false,			fileElementId : 'file',// file控件id			dataType : 'json',			success : function(data, status) {				if(data.status == 200) {					var playId = $(".lottTypeBox:visible")	// 当前玩法组						.find(".lottTypeDetail.active") 		// 玩法						.attr("data-show"); 					// 玩法ID									$(playId).find(".singleNum").val(data.content);					$(playId+" .singleMsg").hide();					refererPage();				} else {					layer5(data.content);				}								$("#file").remove();				$("#fileDiv").append('<input type="file" name="file" id="file"/>');			},			error : function(data, status, e)// 服务器响应失败处理函数			{				$("#file").remove();				$("#fileDiv").append('<input type="file" name="file" id="file"/>');				layer5("上传失败，请重试");			}		});	});		$(".singleMsg").click(function(){		$(this).hide();		$(this).prev().focus();	});		//单式文本框	$(".singleNum").blur(function(){		var t = $(this).val();		t = $.trim(t);		if(t==''){			$(this).next().show();		} else {			$(this).next().hide();		}		$(this).val(t);	});		//单式文本框	$(".singleNum").keyup(function(){		refererPage();	});		//删除错误项	$("a.errBtn").click(function(){		var info = getSelectInfo();				if(info.err && info.err!=''){			layer5('已过滤错误项：'+info.err);			$('.dialogBoxContent[data-type="alert"]').find('.msg').css('text-align','left');		}		if(info.content){			var content = singleDelete(info.content);			var playId = $(this).attr("data-playId");			$(playId+" .singleNum").val(content);		}		refererPage();	});		$("a.cfBtn").click(function(){		var info = getSelectInfo();		var msg = '';		if((info.err && info.err!='') || (info.cf && info.cf!='')){			msg = '<span class="fontColorRed">已过滤错误与重复项:</span><div class="overflowScroll">'+info.err +info.cf + '</div>';		}				if(msg!=''){			layer5(msg);			$('.dialogBoxContent[data-type="alert"]').find('.msg').css('text-align','left');		}				if(info.ncf){		var content = info.ncf;			if(content==''){				$(playId).find(".singleMsg").show();			} else{				$(playId).find(".singleMsg").hide();			}				var playId = $(this).attr("data-playId");			$(playId+" .singleNum").val(content);		}		refererPage();	});		//单式清除	$("a.clearBtn").click(function(){		var playId = $(this).attr("data-playId");		$(playId+" .singleNum").val("");		refererPage();	});	// 按钮点击	$("a.numBtn").click(function() {		var mm = $(this);		var a = mm.parents(".changeNumDetail").find(".numList a");		a.removeClass("active"); // 清		if (mm.hasClass("numBtnAll")) {			a.addClass("active"); // 全		} else if (mm.hasClass("numBtnBig")) {			a.filter(":gt(4)").addClass("active"); // 大 前5个算小。其他算大		} else if (mm.hasClass("numBtnSmall")) {			a.filter(":lt(5)").addClass("active"); // 小 前5个算小。其他算大		} else if (mm.hasClass("numBtnOdd")) {			// 单			if (a.first().attr("data-num") == '1' || a.first().attr("data-num") == '01') {				a.filter(":even").addClass("active");			} else {				a.filter(":odd").addClass("active");			}		} else if (mm.hasClass("numBtnEven")) {			// 双			if (a.first().attr("data-num") == '1' || a.first().attr("data-num") == '01') {				a.filter(":odd").addClass("active");			} else {				a.filter(":even").addClass("active");			}		}		refererPage();	});	// 清空已选号码	$("th.appNumClear").click(function() {		$("#selectBetPanle").html("");		refererPage();	});	// 删除当前注单	$(document).on("click", "a.appNumDetailClear", function() {		$(this).parents(".appNumDetail").remove();		refererPage();	});	// 添加号码栏	$("#addSelectNum").click(function() {		var info = getSelectInfo();		if (info.err && info.err!='') {			layer5('您录入的注单存在错误项,请删除错误项后添加');			return;		}		if (info.count == 0) {			layer5('您尚未选定一个完整的投注');			return;		}				var unitTxt = $("a.amountType.active").text(); // 元、角、分		var unit = parseFloat($("a.amountType.active").attr("data-unit")); // 圆角分金额		var price = parseInt($("#betPrice").val()); // 倍数		var amount = price.mul(unit).mul(info.count); // 总额（单注）		var xml = '<tr class="appNumDetail" data-amount="'				+ amount + '" data-content="' + info.content				+ '" data-count="' + info.count + '" data-id="'				+ info.id + '" data-unit="' + unit				+ '" data-price="' + price + '">';		xml += '<td>【' + info.title + '】</td>';		xml += '<td class="appNum overflowEllipsis">' + info.content.substring(0,40) + '</td>';		xml += '<td>' + unitTxt + '</td>';		xml += '<td>' + info.count + '注</td>';		xml += '<td>' + price + '倍</td>';		xml += '<td class="fontColorTheme">￥' + amount + '元</td>';		xml += '<td><a href="javascript:;" class="appNumDetailClear"></a></td>';		xml += '</tr>';		$("#selectBetPanle").prepend(xml);		$(".numList a").removeClass("active");		//清空单式文本		$(".singleNum").val("");		refererPage();	});	// 追号方式切换	$("a.appNumNav").click(function() {		if ($(this).hasClass("active"))			return;		$("a.appNumNav").removeClass("active");		$(this).addClass("active");		$($(this).attr("data-hide")).hide();		$($(this).attr("data-show")).show();		$(".traceList").html("");		referereTrace();	});	// 同倍追号快捷期数	$(".appendIssue a").click(function() {		$(".appendIssue a").removeClass("active");		$(this).addClass("active");		var v = $(this).attr("data-num");		$("#traceNum1").val(v);	});	// 显示追号面板	$("#appBet").click(function() {		var basePrice = 0;		var allCount = 0;		$(".appNumDetail").each(function() {			var count = parseInt($(this).attr("data-count"));	//注数			var unit = parseFloat($(this).attr("data-unit"));	//单价			basePrice += count.mul(unit);	//单倍金额			allCount += count;	//总注数			$(".traceList").html("");		});		if (basePrice == 0) {			layer5("请先选号");			return;		}		// 记录一倍的金额		$("#traceBox").attr("data-price", basePrice);	//单期单倍全部金额		$("#traceBox").attr("data-count", allCount);	//单期注数		// $("#mask").show();		$.dialog("#traceBox");	});	$(document).on("blur",".traceList .labelCond",function() {		var mul = parseInt($(this).val());		if(mul<1){			$(this).val(1);			mul = 1;		} else {			$(this).val(mul);		}		var basePrice = parseFloat($("#traceBox").attr("data-price"));		var newPrice = mul.mul(basePrice);		$(this).parent().next().text("￥ " + newPrice + " 元")				.attr("data-price", newPrice);		referereTrace();	});	$(document).on("change", "input[name='seasonId']", function() {		var b = $(this).is(":checked");		var t = $(this).parents(".listDetail").find("input[name='price']");		if (b)			t.removeAttr("disabled");		else			t.attr("disabled", "disabled");		referereTrace();	});	// 同倍追号生成	$("#traceCreate1").click(function() {		//期数		var num = parseInt($("#traceNum1").val());		//倍数		var mul = parseInt($("#tracePrice1").val());		if (typeof (price) == 'NaN' || typeof (num) == 'NaN' || mul < 1 || num < 1) {			layer5("倍数或期数错误");			return;		}		var basePrice = parseFloat($("#traceBox").attr("data-price"));		ajaxExt({			url : 'listTraceSeasonId?count=' + num,			callback : function(rel) {				var xml = "";				for ( var n in rel) {					n = parseInt(n);					var nowTxt = "";					if (n == 0) {						nowTxt = '<span class="fontColorTheme">当前期</span>';					}					var d = rel[n];					xml += '<tr class="listDetail">';					xml += '<td>' + (n + 1) + '</td>';					xml += '<td style="text-align:left;"><input type="checkbox" name="seasonId" value="'							+ d.seasonId							+ '" checked="checked" /> <span class="appNumIssue">'							+ d.seasonId							+ nowTxt							+ '</span></td>';					xml += '<td><input type="text" class="labelCond" name="price" value="'							+ mul + '" /> <span>倍</span></td>';					xml += '<td data-price="'							+ mul.mul(basePrice) + '">￥ '							+ mul.mul(basePrice) + ' 元</td>';					xml += '<td>' + d.openTime + '</td>';					xml += '</tr>';				}				$(".appendBox:visible .traceList").html(xml);				referereTrace();			}		});	});		// 利率追号生成	$("#traceCreate2").click(function() {		var bate = parseInt($("#traceBate").val());	//最小利率		var num = parseInt($("#traceNum2").val());	//总期数				//倍数		if (typeof (bate) == 'NaN' || typeof (num) == 'NaN'  || bate < 1 || num < 1) {			layer5("所有都必须为数字，并且大于0");			return;		}		var allCount = $("#selectBetPanle tr").length;		if(allCount!=1){			layer5("盈利率追号不支持多选、混投");			return;		}				var tr = $("#selectBetPanle tr:first");				var id = tr.attr("data-id");					//玩法		var unit = parseFloat(tr.attr("data-unit"));	//单价						//高奖金		var bonus = parseFloat(parseFloat($(".lottTypeDetail[data-show='#"+ id +"']").attr("data-MaxBonus")).toFixed(4));		bonus = bonus.mul(unit).div(2);	//根据单价得到的奖金		//倍数		var basePrice = parseFloat($("#traceBox").attr("data-price"));//一倍的总价				var ll = bonus.sub(basePrice).div(basePrice).mul(100);	//利率		if(ll<bate){			layer5("您设置的利率无法满足,请重新设置");			return;		}				var win = allCount.mul(bonus);		var allBetMoney = 0;		var nowMul = 1;	//当前倍数		ajaxExt({			url : 'listTraceSeasonId?count=' + num,			callback : function(rel) {				var xml = "";				for ( var n in rel) {					n = parseInt(n);					var nowTxt = "";					if (n == 0) {						nowTxt = '<span class="fontColorTheme">当前期</span>';					}					var nowMoney = 0;					var nowBonus = 0;					var nowWin =  0;					var nowLv = ll;					var ifAllBetMoney = allBetMoney;					while(true){						nowMoney = nowMul.mul(basePrice);			//当期金额						nowBonus = win.mul(nowMul);					//当期奖金												ifAllBetMoney = allBetMoney.add(nowMoney);	//累计金额						nowWin = nowBonus.sub(ifAllBetMoney);			//累计盈利						nowLv = parseFloat(nowWin.div(ifAllBetMoney).mul(100).toFixed(4));	//盈利利率						//if(nowMul>=9999) break;						if(nowLv<bate){							nowMul = nowMul.add(1);	//加一倍						} else {							break;						}					};					allBetMoney = ifAllBetMoney;					var d = rel[n];					xml += '<tr class="listDetail">';					xml += '<td>' + (n + 1) + '</td>';					xml += '<td style="text-align:left;"><input type="checkbox" name="seasonId" value="'							+ d.seasonId							+ '" checked="checked" /> <span class="appNumIssue">'							+ d.seasonId							+ nowTxt							+ '</span></td>';					xml += '<td><input type="text" class="labelCond" name="price" value="'							+ nowMul + '" /> <span>倍</span></td>';					xml += '<td data-price="'							+ nowMoney + '">￥ '							+ nowMoney + ' 元</td>';										xml += "<td>"+ nowBonus.toFixed(4) +"</td>";					xml += "<td>"+ nowWin.toFixed(4) +"</td>";					xml += "<td>"+ nowLv.toFixed(4) +"%</td>";					xml += '</tr>';				}				$(".appendBox:visible .traceList").html(xml);				referereTrace();			}		});	});		// 翻倍追号生成	$("#traceCreate3").click(function() {		var begin = parseInt($("#traceBeginMul3").val());	//开始倍数		var split = parseInt($("#traceMidSeason3").val());	//间隔		var mul = parseInt($("#traceMul3").val());			//翻倍数		var num = parseInt($("#traceNum3").val());			//总期数				//倍数		if (typeof (begin) == 'NaN' || typeof (split) == 'NaN' ||typeof (mul) == 'NaN' || typeof (num) == 'NaN' || begin < 1 || split < 1 || mul < 1 || num < 1) {			layer5("所有都必须为数字，并且大于0");			return;		}		//单倍金额		var basePrice = parseFloat($("#traceBox").attr("data-price"));		var nowSplit = 0;		var nowMul = begin;		ajaxExt({			url : 'listTraceSeasonId?count=' + num,			callback : function(rel) {				var xml = "";				for ( var n in rel) {					n = parseInt(n);					var nowTxt = "";					if (n == 0) {						nowTxt = '<span class="fontColorTheme">当前期</span>';					}					var d = rel[n];					xml += '<tr class="listDetail">';					xml += '<td>' + (n + 1) + '</td>';					xml += '<td style="text-align:left;"><input type="checkbox" name="seasonId" value="'							+ d.seasonId							+ '" checked="checked" /> <span class="appNumIssue">'							+ d.seasonId							+ nowTxt							+ '</span></td>';					xml += '<td><input type="text" class="labelCond" name="price" value="'							+ nowMul + '" /> <span>倍</span></td>';					xml += '<td data-price="'							+ nowMul.mul(basePrice) + '">￥ '							+ nowMul.mul(basePrice) + ' 元</td>';					xml += '<td>' + d.openTime + '</td>';					xml += '</tr>';					nowSplit++;					if(nowSplit==split){						nowMul = nowMul.mul(mul);						nowSplit = 0;					}				}				$(".appendBox:visible .traceList").html(xml);				referereTrace();			}		});	});	// 立即投注	$("#promptlyBet").click(function() {		var info = getSelectInfo();		if (info.err && info.err!='') {			layer5('您录入的注单存在错误项,请删除错误项后添加');			return;		}		if (info.count == 0) {			layer5('亲~请选择完整的投注号码：）');			return;		}		// 高返高奖		var bounsType = $("#bounsType").val();		// 倍数		var price = parseInt($("#betPrice").val());		// 单价		var unit = parseFloat($("a.amountType.active")				.attr("data-unit"));		var amount = price.mul(unit).mul(info.count);		var formInputs = '<input type="hidden" name="isTrace" value="0"/>';		formInputs += '<input type="hidden" name="traceWinStop" value="0"/>';		formInputs += '<input type="hidden" name="bounsType" value="'+bounsType+'"/>';		formInputs += '<input type="hidden" name="order[0].playId" value="'+info.id+'"/>';		formInputs += '<input type="hidden" name="order[0].content" value="'+info.content+'"/>';		formInputs += '<input type="hidden" name="order[0].betCount" value="'+info.count+'"/>';		formInputs += '<input type="hidden" name="order[0].price" value="'+price+'"/>';		formInputs += '<input type="hidden" name="order[0].unit" value="'+unit+'"/>';		formInputs += '<input type="hidden" name="traceOrders[0].seasonId" value="'+$("#saleSeasonId").text()+'"/>';		formInputs += '<input type="hidden" name="amount" value="'+amount+'"/>';		formInputs += '<input type="hidden" name="count" value="'+info.count+'"/>';				var cn = '';		if(info.content.length>20){			cn = info.content.substring(0,20)+"...";		} else {			cn = info.content;		}				var trs ='<tr>';		trs+='<td>【'+ info.title +'】</td>';		trs+='<td width="180">'+ cn +'</td>';		trs+='</tr>';				$("#betConfirmForm").html(formInputs);		$("#betConfirmTable").html(trs);		$("#betConfirmAmount").text(amount);				betOnce(1);			});		$("#traceNum1,#traceNum2,#traceNum3").change(function(){		var max = parseInt( $("#maxPlan").attr("data-plan"));		var val = parseInt( $(this).val());		if(max<val){			$(this).val(max);		}	});	// 投注确认	$("#promptlyBet2,#lotteryBall").click(function() {		if($(this).hasClass('disabled')) {			return;		}		// 号码行		var allAmount = 0;		var allCount = 0;		if($("tr.appNumDetail").length == 0){			layer5('您未选择号码！');			return;		}				$(this).addClass('disabled');		var i = 0;		var formInputs = '<input type="hidden" name="isTrace" value="0"/>';		formInputs += '<input type="hidden" name="traceWinStop" value="0"/>';		formInputs += '<input type="hidden" name="bounsType" value="'+$("#bounsType").val()+'"/>';		var trs = '';		$("tr.appNumDetail").each(function() {			var id = $(this).attr("data-id"); // 玩法			var content = $(this).attr("data-content"); // 内容			var count =parseInt( $(this).attr("data-count")); // 注数			var amount = parseFloat($(this).attr("data-amount")); // 单注金额			var price = $(this).attr("data-price"); // 倍数			var unit = $(this).attr("data-unit"); // 单价						allAmount = allAmount.add(amount);			allCount = allCount.add(count);						formInputs += '<input type="hidden" name="order[' + i + '].playId" value="'+id+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].content" value="'+content+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].betCount" value="'+count+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].price" value="'+price+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].unit" value="'+unit+'"/>';						trs +='<tr>';			trs+='<td>'+ $(this).find("td:first").text() +'</td>';			trs+='<td width="180">'+ $(this).find("td:eq(1)").text() +'</td>';			trs+='</tr>';						i++;		});				formInputs += '<input type="hidden" name="traceOrders[0].seasonId" value="'+$("#saleSeasonId").text()+'"/>';		formInputs += '<input type="hidden" name="amount" value="'+allAmount+'"/>';		formInputs += '<input type="hidden" name="count" value="'+allCount+'"/>';		$("#betConfirmForm").html(formInputs);		$("#betConfirmTable").html(trs);		$("#betConfirmAmount").text(allAmount);				betMore($("#traceNum").val());			});		//追号确认按钮	$("#traceSubmit").click(function() {		var v = $("#traceWinStop").is(":checked") == true ? 1 : 0;				var formInputs = '<input type="hidden" name="isTrace" value="1"/>';		formInputs += '<input type="hidden" name="traceWinStop" value="'+v+'"/>';		formInputs += '<input type="hidden" name="bounsType" value="'+$("#bounsType").val()+'"/>';				var trs = '';				var allAmount = 0, allCount = 0, i = 0;				var oneSeasonAmount = 0;	//单期单倍金额		var traceAmount=0;			//追号总额				//具体下注内容		$("tr.appNumDetail").each(function() {			var id = $(this).attr("data-id"); // 玩法			var content = $(this).attr("data-content"); // 内容			var count =parseInt( $(this).attr("data-count")); // 注数			var amount = parseFloat($(this).attr("data-amount")); // 单注金额			var price = $(this).attr("data-price"); // 倍数			var unit = $(this).attr("data-unit"); // 单价			allAmount = allAmount.add(amount);			allCount = allCount.add(count);			formInputs += '<input type="hidden" name="order[' + i + '].playId" value="'+id+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].content" value="'+content+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].betCount" value="'+count+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].price" value="'+price+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].unit" value="'+unit+'"/>';						oneSeasonAmount = oneSeasonAmount.add(count.mul(unit));			trs +='<tr>';			trs+='<td>'+ $(this).find("td:first").text() +'</td>';			trs+='<td width="180">'+ $(this).find("td:eq(1)").text() +'</td>';			trs+='</tr>';			i++;		});		i = 0;		$(".appendBox:visible .traceList tr").each(function() {			var seasonId = $(this).find("input[name='seasonId']");			if (seasonId.is(":checked")) {				var p = $(this).find("input[name='price']").val();				formInputs += '<input type="hidden" name="traceOrders['+i+'].seasonId" value="'+seasonId.val()+'"/>';				formInputs += '<input type="hidden" name="traceOrders['+i+'].price" value="'+p+'"/>';				traceAmount = traceAmount.add(oneSeasonAmount.mul(p));				i++;			}		});		formInputs += '<input type="hidden" name="amount" value="'+allAmount+'"/>';		formInputs += '<input type="hidden" name="count" value="'+allCount+'"/>';		$("#betConfirmForm").html(formInputs);		$("#betConfirmTable").html(trs);		$("#betConfirmAmount").text(traceAmount);		$.dialog("#betConfirmBox");	});		// 默认选择的菜单	$("li.lottNavDetail:eq("+ lottery.defaultIndex +")").click();	$(".lottTypeBox:visible").find(".lottTypeDetail[data-show='#"+lottery.defaultPlayer+"']").click();});function betAgain(mul, bounsType, seasonId, amount, count, arr) {	mul = mul || 1;	if (arr) {		var formInputs = '<input type="hidden" name="isTrace" value="0"/>';		formInputs += '<input type="hidden" name="traceWinStop" value="0"/>';		formInputs += '<input type="hidden" name="bounsType" value="'+bounsType+'"/>';				var i = 0;		$(arr).each(function() {			formInputs += '<input type="hidden" name="order[' + i + '].playId" value="'+this.playId+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].content" value="'+this.content+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].betCount" value="'+this.betCount+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].price" value="'+this.price.mul(mul)+'"/>';			formInputs += '<input type="hidden" name="order[' + i + '].unit" value="'+this.unit+'"/>';			i++;		});				formInputs += '<input type="hidden" name="traceOrders[0].seasonId" value=""/>';		formInputs += '<input type="hidden" name="amount" value="'+amount.mul(mul)+'"/>';		formInputs += '<input type="hidden" name="count" value="'+count+'"/>';				$("#betConfirmForm").html(formInputs);		betOnce();	}}var tigerLotteryTimes = 1;// 连投次数var tigerLotteryWin = 0;// 连投中奖总金额function betMore(traceNum) {	traceNum = parseInt(traceNum);	if (typeof (traceNum) == 'NaN') {		layer5("倍数错误");		return;	}	$('html, body').animate({scrollTop:0}, 'slow');// 滚到最顶部，可以看到开奖动画	tigerLotteryTimes = traceNum;	tigerLotteryWin = 0;	bet(traceNum);}function betOnce() {	betMore(1);}function bet(traceNum) {	if (traceNum <= 0) {		$('#promptlyBet2').removeClass('disabled');		return;	}		betBegin();		var times = tigerLotteryTimes - traceNum + 1;		layer.closeAll();// 关闭所有弹出框	if (tigerLotteryTimes > 1) {// 连投		layer3(times);// 显示第x次开奖	}	traceNum--;// 连投次数-1		betBallAnimate();// 摇杆动画	lottNumAnimate();// 开奖动画	ajaxExt({		url:'bet',		method:"POST",		data: $("#betConfirmForm").serialize(),		callback:function(rel) {			refererSlotMachine(rel.betList[0].openNum);			$(this).oneTime('30ds', 'startLott', function() {  //动画倒数3s开奖后停止				endAnimateCont = true;			});			var isLayer = setInterval(function(){				if(lastEndAnimate){					clearInterval(isLayer);					lastEndAnimate = false;										tigerLotteryWin = tigerLotteryWin.add(rel.win);					var delay = 0;					if (tigerLotteryTimes > 1) {// 连投						delay = 3000;						if (rel.win > 0) {							layer4(times, rel.win);						} else {							layer5('本次未中奖！');						}					} else {						if (rel.win > 0) {							layer1(rel.win, rel.order);						} else {							layer2(rel.win, rel.order);						}					}										//刷新投注列表					refererBetList(rel.betList,true);																$("#selectBetPanle").html("");				//清空代投列表					$(".numList a").removeClass("active");		//清空号码盘数据					$(".singleNum").val("");					//清空单式文本					refererPage();					$("#refererUser").click();					//刷新余额										setTimeout(function() {						if (tigerLotteryTimes > 1 && traceNum == 0) {// 连投且是最后一期							// 弹出总得结果							layer.closeAll();// 关闭所有弹出框							if (tigerLotteryWin > 0) {								layer1(tigerLotteryWin, rel.order);							} else {								layer2(tigerLotteryWin, rel.order);							}						}						betDone();						bet(traceNum);					}, delay);				}			},1000);		},		complete:function(){		}	});}function betBegin() {	$('#promptlyBet,#promptlyBet2,#lotteryBall').attr("disabled",true);}function betDone() {	$('#promptlyBet,#promptlyBet2,#lotteryBall').removeAttr('disabled');	if (!lastEndAnimate) {// 开奖动画仍然在转动，说明有错误		endAnimateCont = true;	}}//更新老虎机号码function refererSlotMachine(data){	var openNums = data.split(',');	$('#openNums li').each(function(index){		var openNum = ~~openNums[index];		$(this).find('p').eq(openNum).addClass('active').siblings().removeClass('active');	});}//开奖号码动画function lottNumAnimate(){	var height = $('.lottNumDetail p:first').height();	var lottCount = 0;	endAnimateCont = false;	lastEndAnimate = false;	$('.lottNumDetail').each(function (index) {		var oSpeed = {};		var a = 's' + index;		oSpeed[a] = 1;		//每个开奖号码只执行一次		$(this).stopTime('lottNumDetail' + index);		$(this).oneTime( (index*5) + 'ds', 'lottNumDetail' + index, function () {			//第二版动画			//原理：**获取每个开奖号码位置的可选号码，默认位置为第一个号码**			//		1、动画定位到具体的开奖号码位置------×			//		2、加速度，仿ease-in效果，到最大速度，再做匀速度，持续几秒 或 转几轮			//		3、减速度，仿ease-out效果，通过开奖号码位置计算从何时开始减速度，直到动画走到开奖号码位置			var lottNum = $(this).find('p').length - 1;//获取每个开奖号码位置共有多少可选号码			var b = 's' + index;			var pos;			$(this).stopTime('lottNumStart' + index);			for ( var i in oSpeed ) {				if ( i == b ){					//加速度					$(this).everyTime('2ds', 'lottNumStart' + index, function(){						if (oSpeed[i] < 10){							oSpeed[i]++;						} else {							$(this).stopTime('lottNumStart' + index);							if(!animateVersion){								endAnimateCont = true;							}						}					});				}			}			//匀速度			$(this).stopTime('lottNumAll' + index);			$(this).everyTime( '10ms', 'lottNumAll' + index, function(){				var posTop = parseInt($(this).css('margin-top'));				var posEnd = lottNum * -height;				//到最后一个号码的位置时，跳到第一个号码				if (posTop <= posEnd) {					posTop = 0;					$(this).css('margin-top', posTop);				}				posTop ? posTop : 0;				//停止动画时获取当前开奖号码位置				var lottNumTotal = $(this).find('p');				var lottNumIndex = lottNumTotal.index($(this).find('p.active'));				//当开奖号码为第一个数字的时候				if (lottNumIndex == 0){					lottNumIndex = -0;				}				var numEndPos = lottNumIndex * -height;//开奖号码所在的位置				//到开奖号码时停止动画				if (endAnimateCont && index == lottCount) {					$(this).oneTime('3ds', 'lottNumStop' + lottCount, function() {						if (pos >= numEndPos - height && pos <= numEndPos + height) {							oSpeed[b] = 0;							$(this).stopTime('lottNumStop' + lottCount);							$(this).stopTime('lottNumAll' + index);							$(this).stopTime('lottNumStart' + index);							$(this).stopTime('lottNumDetail' + index);							$(this).css('margin-top', numEndPos + 'px');							lottCount++;							if(index == ($('.lottNumDetail').size()-1)){								lastEndAnimate = true;							}							return;						}					});									}				pos = posTop - oSpeed[b];				pos = pos <= posEnd ? posEnd : pos;				$(this).css('margin-top', pos + 'px');			})		});	});}