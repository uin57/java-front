/** * Created by Administrator on 2016/4/13. */var obj = {    sign: [],    days: 0,    today: false};$(function () {    createCalendar();//默认创建日历    checkinDays();//默认遍历签到累积天数    //领取签到奖励    $('body').on('click', '.getRewarding', function () {        ajaxExt({            url: '/activity/bonus/sign',            dataType: 'json',            callback: function (data) {                console.log(data);                createCalendar();//刷新日历                checkinDays();//刷新签到区域                $('#signDays').html(obj.days);            }        });    });});function createCalendar() {    //清空原有日历    $('#calendarBody').html('');    var currDate = new Date();//当前日期，不能变动的日期    var currYear = currDate.getFullYear();    var currMonth = currDate.getMonth();    //更换月份时动态创建日历    activeDate(currMonth);    $('#datePrev').click(function () {        $('#calendarBody').html('');        activeDate(--currMonth);    });    $('#dateNext').click(function () {        $('#calendarBody').html('');        activeDate(++currMonth);    });    function activeDate(m) {        var activeDate = new Date(currYear, m, 1);//动态变动的日期        activeDate.setDate(1);        var activeMonth = activeDate.getMonth();        $('#dateTitle').html(activeDate.getFullYear() + '年' + (activeMonth + 1) + '月');        var firstDay = 1 - activeDate.getDay();        if (firstDay == 1) {            firstDay = -6;        }        activeDate.setDate(firstDay);        //获取签到的参数        ajaxExt({            url: '/activity/sign?date=' + toDate(0, currYear, m + 1),            noError: true,            async: false,            dataType: 'json',            callback: function (data) {                obj.sign = data.signDays;                obj.days = data.days;                obj.today = data.signToday;            }        });        //遍历每行日期        for (var i = 0; i < 6; i++) {            var oTr = document.createElement('tr');            oTr.className = 'dayList';            for (var j = 0; j < 7; j++) {                var oTd = document.createElement('td');                var y = activeDate.getFullYear();                var m = activeDate.getMonth();                var d = activeDate.getDate();                var date = toDate(1, y, m + 1, d);                if (activeMonth != m) {//非本月的日期设为灰色                    oTd.style.color = '#ccc';                }                //遍历已签到日期                $(obj.sign).each(function () {                    if (date == this) {                        oTd.style.backgroundColor = '#2bc1c1';                        oTd.style.color = '#fff';                    }                });                oTd.innerHTML = d;                oTd.setAttribute('data-id', date);                oTr.appendChild(oTd);                activeDate.setDate(d + 1);//日期递增一天            }            $('#calendarBody').append(oTr);//将每行日期追加到表格内        }    }}//合并年月日，并强制转换为字符串function toDate(z, y, m, d) {    m = m < 10 ? String('0' + m) : String(m);    d = d < 10 ? String('0' + d) : String(d);    if (z == 0) {        return String(y + '-' + m + '-01 12:00:00');    }    if (z == 1) {        return y + m + d;    }}//遍历签到累积天数function checkinDays() {    var index = obj.days;    $('#signDays').html(obj.days);    $('.getRewardDetail').each(function () {        if (index > 0) {            $(this).addClass('active').find('.btn').removeClass('getRewarding').addClass('getRewarded');        }        if (index == 0 && !obj.today) {//未领            $(this).addClass('active').find('.btn').addClass('getRewarding');        }        index--;    });}