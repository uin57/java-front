<%@page contentType="text/html" pageEncoding="UTF-8" %><%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %><%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %><input type="hidden" id="pageCountMessage" value="${p.rowCount }"/><table class="userListTable" id="messageListTable">	<tr class="listHeader">		<th width="10%">序号</th>		<th style="text-align:left; padding-left:20px;" width="80%">主题</th>		<th>发送人</th>		<th>发送时间</th>		<th>接收人</th>		<th>状态</th>		<th width="10%">操作</th>	</tr>	<c:forEach items="${messageList }" var="message" varStatus="st">		<input id="messageSendContet_${message.id }" value="<c:out value="${message.sendContent }"></c:out>"			   type="hidden"/>		<tr class="listDetail ${((user.account != message.sender && message.revStatus == 0) || (user.account == message.sender && message.sendStatus == 4)) ? 'fontBold' : '' }">			<td>${st.index + p.startIndex + 1 }</td>			<td style="text-align:left; padding-left:20px;" id="messageTitle_${message.id }"><c:out					value="${message.title }"></c:out></td>			<td>				<c:choose>					<c:when test="${message.sendType == 0 }">系统</c:when>					<c:otherwise>						<c:choose>							<c:when test="${message.sender == user.parentAccount && user.parentAccount != user.account }">上级</c:when>							<c:otherwise>${message.sender }</c:otherwise>						</c:choose>					</c:otherwise>				</c:choose>			</td>			<td><fmt:formatDate value="${message.sendTime }" pattern="yyyy-MM-dd HH:mm:ss"/></td>			<td>				<c:choose>					<c:when test="${message.rever == user.parentAccount && user.parentAccount != user.account }">上级</c:when>					<c:otherwise>${message.rever }</c:otherwise>				</c:choose>			</td>			<td id="messageRevStatus_${message.id }">				<c:choose>					<c:when test="${user.account == message.sender }">						<c:if test="${message.sendStatus == 0 }">已发送</c:if>						<c:if test="${message.sendStatus == 1 }">已取消</c:if>						<c:if test="${message.sendStatus == 2 }">已回复</c:if>						<c:if test="${message.sendStatus == 4 }">未读</c:if>						<c:if test="${message.sendStatus == 5 }">已读</c:if>					</c:when>					<c:otherwise>						<c:if test="${message.revStatus == 0 }">未读</c:if>						<c:if test="${message.revStatus == 1 }">已读</c:if>						<c:if test="${message.revStatus == 2 }">已回复</c:if>					</c:otherwise>				</c:choose>			</td>			<td class="operate">				<a href="javascript:;" onclick="messageDetail('${message.id }','${message.title }');"				   class="operateBtn delete fontColorTheme">详情</a>				<a href="javascript:;" onclick="messageDelete('${message.id }');"				   class="operateBtn delete fontColorTheme">删除</a>			</td>		</tr>	</c:forEach></table><c:if test="${messageList == null || messageList.size() == 0 }">	<!-- 没有消息 -->	<div class="nullMsg">		<i class="nullMsgImg"></i>		<span class="fontColorGray">暂时还没有信息哦~</span>	</div></c:if><script type="text/javascript">	var specicalStr = "${specicalStr }";	function checkHadSpecialChar(text) {		for (var i in specicalStr) {			if (text.indexOf(specicalStr[i]) >= 0) {				return true;			}		}		return false;	}	function messageDelete(id) {		ajaxObject('/message/messageDelete?id=' + id, "POST", function () {			$("#messageSearch").click();		});	}	function messageDetail(id, title) {		ajaxLoad('messageDetailDiv', '/message/messageContentRead?id=' + id, {}, function (data) {			layer.open({				type: 1,				skin: 'msgDetailsLayer',				shift: 5,				area: ['450px', '460px'],				title: title,				content: $('#messageDetailDiv')			});			$('#messageContentDiv').scrollTop($('#messageContentDiv')[0].scrollHeight);		});	}	function messageReply(id) {		var revContent = $("#msgSendContent").val();		if (!revContent) {			$.alert("请输入回复内容！");			return false;		}		if (checkHadSpecialChar(revContent)) {			$.alert("回复内容不能包含特殊字符！");			return false;		}		if (id) {			Service("/message/messageContentReply", "POST", {"id": id, "revContent": revContent}, 1, function (data) {				if (data == 1) {					$("#messageContentDiv").append('<p class="textRight"><span class="messageInfo messageRight" style="margin-right: 10px;">' + revContent + '</span><span class="msgUserName">我</span><p>').scrollTop($('#messageContentDiv')[0].scrollHeight);					$("#msgSendContent").val("").focus();				}			});		}	}	var contactType = 0;	function contact(type) {		$("#messageTitle").val("");		$("#messageSendContent").val("");		$("#messageReverCheckSpan").text("");		$("#msgErrorWarn").text("");		if ('up' == type) {			contactType = 0;			$("#messageReverCheck").hide();			$("#messageRever").attr({"readonly": "readonly", "tabindex": "-1"}).val("上级");		} else if ('dw' == type) {			contactType = 1;			$("#messageReverCheck").show();			$("#messageRever").removeAttr("readonly").val("");		}		layer.open({			type: 1,			skin: 'msgUserContactLayer',			shift: 5,			area: ['450px', '330px'],			title: '发送消息',			content: $('#messageContactDiv')		});	}	function messageReverCheck() {		$("#messageReverCheckSpan").text("");		var rever = $("#messageRever").val();		if (!rever) {			$("#messageReverCheckSpan").text("不能为空");			return false;		}		ajaxObject('/message/messageReverCheck?account=' + rever, "POST", function (data) {			if (data) {				$("#messageReverCheckSpan").text("通过");			} else {				$("#messageReverCheckSpan").text("不存在");			}		});	}	function sendMessage() {		clearMessage();		var rever = $("#messageRever").val();		if (!rever) {			$("#msgErrorWarn").text("接收人不能为空！");			return false;		}		var title = $("#messageTitle").val();		if (!title) {			$("#msgErrorWarn").text("请输入标题！");			return false;		}		if (title.length > 50) {			$("#msgErrorWarn").text("主题不超过50字！");			return false;		}		if (checkHadSpecialChar(title)) {			$.alert("标题不能包含特殊字符！");			return false;		}		var sendContent = $("#messageSendContent").val();		if (!sendContent) {			$("#msgErrorWarn").text("请输入发送内容！");			return false;		}		if (checkHadSpecialChar(sendContent)) {			$.alert("发送内容不能包含特殊字符！");			return false;		}		Service("/message/messageSend", "POST", {			"rever": rever,			"sendContent": sendContent,			"title": title,			"contactType": contactType		}, 1, function (data) {			layer.closeAll();			$("#messageSearch").click();		});	}	function clearMessage() {		$("#messageErrorRever").text("");		$("#messageErrorTitle").text("");		$("#messageErrorSendContent").text("");		$("#showMessageTitle").text("");		$("#showMessageSendContent").text("");		$("#showMessageRevContent1").val("");		$("#showMessageRevContent2").text("");		$("#messageReverCheckSpan").text("");	}</script>